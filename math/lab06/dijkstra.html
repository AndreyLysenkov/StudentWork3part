<br><font size="2" face="Courier New" color="black"><br><font color="#008000">/// <summary></font>   <br><font color="#008000">/// Реализация алгоритма Дейкстры. Содержит матрицу смежности в виде массивов вершин и ребер</font>   <br><font color="#008000">/// </summary></font>   <br><font color="#0000ff">class</font> DekstraAlgorim   {     <br><font color="#0000ff">public</font> Point[] points { <br><font color="#0000ff">get</font>; <br><font color="#0000ff">private</font> <br><font color="#0000ff">set</font>; }     <br><font color="#0000ff">public</font> Rebro[] rebra { <br><font color="#0000ff">get</font>; <br><font color="#0000ff">private</font> <br><font color="#0000ff">set</font>; }     <br><font color="#0000ff">public</font> Point BeginPoint { <br><font color="#0000ff">get</font>; <br><font color="#0000ff">private</font> <br><font color="#0000ff">set</font>; }     <br><font color="#0000ff">public</font> DekstraAlgorim(Point[] pointsOfgrath, Rebro[] rebraOfgrath)     {       points = pointsOfgrath;       rebra = rebraOfgrath;     }     <br><font color="#008000">/// <summary></font>     <br><font color="#008000">/// Запуск алгоритма расчета</font>     <br><font color="#008000">/// </summary></font>     <br><font color="#008000">/// <param name="beginp"></param></font>     <br><font color="#0000ff">public</font> <br><font color="#0000ff">void</font> AlgoritmRun(Point beginp)     {       <br><font color="#0000ff">if</font> (<br><font color="#0000ff">this</font>.points.Count() == 0 || <br><font color="#0000ff">this</font>.rebra.Count() == 0)       {         <br><font color="#0000ff">throw</font> <br><font color="#0000ff">new</font> DekstraException(<br><font color="#A31515">"Массив вершин или ребер не задан!"</font>);       }       <br><font color="#0000ff">else</font>       {         BeginPoint = beginp;         OneStep(beginp);         <br><font color="#0000ff">foreach</font> (Point point <br><font color="#0000ff">in</font> points)         {           Point anotherP = GetAnotherUncheckedPoint();           <br><font color="#0000ff">if</font> (anotherP != <br><font color="#0000ff">null</font>)           {             OneStep(anotherP);           }           <br><font color="#0000ff">else</font>           {             <br><font color="#0000ff">break</font>;           }         }       }     }     <br><font color="#008000">/// <summary></font>     <br><font color="#008000">/// Метод, делающий один шаг алгоритма. Принимает на вход вершину</font>     <br><font color="#008000">/// </summary></font>     <br><font color="#008000">/// <param name="beginpoint"></param></font>     <br><font color="#0000ff">public</font> <br><font color="#0000ff">void</font> OneStep(Point beginpoint)     {       <br><font color="#0000ff">foreach</font>(Point nextp <br><font color="#0000ff">in</font> Pred(beginpoint))       {         <br><font color="#0000ff">if</font> (nextp.IsChecked == <br><font color="#0000ff">false</font>)<br><font color="#008000">//не отмечена</font>         {           <br><font color="#0000ff">float</font> newmetka = beginpoint.ValueMetka + GetMyRebro(nextp, beginpoint).Weight;           <br><font color="#0000ff">if</font> (nextp.ValueMetka > newmetka)           {             nextp.ValueMetka = newmetka;             nextp.predPoint = beginpoint;           }           <br><font color="#0000ff">else</font>           {           }         }       }       beginpoint.IsChecked = <br><font color="#0000ff">true</font>;<br><font color="#008000">//вычеркиваем</font>     }     <br><font color="#008000">/// <summary></font>     <br><font color="#008000">/// Поиск соседей для вершины. Для неориентированного графа ищутся все соседи.</font>     <br><font color="#008000">/// </summary></font>     <br><font color="#008000">/// <param name="currpoint"></param></font>     <br><font color="#008000">/// <returns></returns></font>     <br><font color="#0000ff">private</font> <br><font color="#2B91AF">IEnumerable</font><Point> Pred(Point currpoint)     {       <br><font color="#2B91AF">IEnumerable</font><Point> firstpoints = <br><font color="#0000ff">from</font> ff <br><font color="#0000ff">in</font> rebra <br><font color="#0000ff">where</font> ff.FirstPoint==currpoint <br><font color="#0000ff">select</font> ff.SecondPoint;       <br><font color="#2B91AF">IEnumerable</font><Point> secondpoints = <br><font color="#0000ff">from</font> sp <br><font color="#0000ff">in</font> rebra <br><font color="#0000ff">where</font> sp.SecondPoint == currpoint <br><font color="#0000ff">select</font> sp.FirstPoint;       <br><font color="#2B91AF">IEnumerable</font><Point> totalpoints = firstpoints.Concat<Point>(secondpoints);       <br><font color="#0000ff">return</font> totalpoints;     }     <br><font color="#008000">/// <summary></font>     <br><font color="#008000">/// Получаем ребро, соединяющее 2 входные точки</font>     <br><font color="#008000">/// </summary></font>     <br><font color="#008000">/// <param name="a"></param></font>     <br><font color="#008000">/// <param name="b"></param></font>     <br><font color="#008000">/// <returns></returns></font>     <br><font color="#0000ff">private</font> Rebro GetMyRebro(Point a, Point b)     {<br><font color="#008000">//ищем ребро по 2 точкам</font>       <br><font color="#2B91AF">IEnumerable</font><Rebro> myr = <br><font color="#0000ff">from</font> reb <br><font color="#0000ff">in</font> rebra <br><font color="#0000ff">where</font> (reb.FirstPoint == a & reb.SecondPoint == b) || (reb.SecondPoint == a & reb.FirstPoint == b) <br><font color="#0000ff">select</font> reb;       <br><font color="#0000ff">if</font> (myr.Count() > 1 || myr.Count() == 0)       {         <br><font color="#0000ff">throw</font> <br><font color="#0000ff">new</font> DekstraException(<br><font color="#A31515">"Не найдено ребро между соседями!"</font>);       }       <br><font color="#0000ff">else</font>       {         <br><font color="#0000ff">return</font> myr.First();       }     }     <br><font color="#008000">/// <summary></font>     <br><font color="#008000">/// Получаем очередную неотмеченную вершину, "ближайшую" к заданной.</font>     <br><font color="#008000">/// </summary></font>     <br><font color="#008000">/// <returns></returns></font>     <br><font color="#0000ff">private</font> Point GetAnotherUncheckedPoint()     {       <br><font color="#2B91AF">IEnumerable</font><Point> pointsuncheck = <br><font color="#0000ff">from</font> p <br><font color="#0000ff">in</font> points <br><font color="#0000ff">where</font> p.IsChecked == <br><font color="#0000ff">false</font> <br><font color="#0000ff">select</font> p;       <br><font color="#0000ff">if</font> (pointsuncheck.Count() != 0)       {         <br><font color="#0000ff">float</font> minVal = pointsuncheck.First().ValueMetka;         Point minPoint = pointsuncheck.First();         <br><font color="#0000ff">foreach</font> (Point p <br><font color="#0000ff">in</font> pointsuncheck)         {           <br><font color="#0000ff">if</font> (p.ValueMetka < minVal)           {             minVal = p.ValueMetka;             minPoint = p;           }         }         <br><font color="#0000ff">return</font> minPoint;       }       <br><font color="#0000ff">else</font>       {         <br><font color="#0000ff">return</font> <br><font color="#0000ff">null</font>;       }     }                <br><font color="#0000ff">public</font> <br><font color="#2B91AF">List</font><Point> MinPath1(Point end)     {       <br><font color="#2B91AF">List</font><Point> listOfpoints = <br><font color="#0000ff">new</font> <br><font color="#2B91AF">List</font><Point>();       Point tempp = <br><font color="#0000ff">new</font> Point();       tempp = end;       <br><font color="#0000ff">while</font> (tempp != <br><font color="#0000ff">this</font>.BeginPoint)       {         listOfpoints.Add(tempp);         tempp = tempp.predPoint;       }       <br><font color="#0000ff">return</font> listOfpoints;     }</font> <br><font size="1" color="gray">* This source code was highlighted with <a href="http://virtser.net/blog/post/source-code-highlighter.aspx"><br><font size="1" color="gray">Source Code Highlighter</font></a>.</font>


<br><font size="2" face="Courier New" color="black"><br><font color="#008000">/// <summary></font>   <br><font color="#008000">/// Класс, реализующий ребро</font>   <br><font color="#008000">/// </summary></font>   <br><font color="#0000ff">class</font> Rebro   {     <br><font color="#0000ff">public</font> Point FirstPoint { <br><font color="#0000ff">get</font>; <br><font color="#0000ff">private</font> <br><font color="#0000ff">set</font>; }     <br><font color="#0000ff">public</font> Point SecondPoint { <br><font color="#0000ff">get</font>; <br><font color="#0000ff">private</font> <br><font color="#0000ff">set</font>; }     <br><font color="#0000ff">public</font> <br><font color="#0000ff">float</font> Weight { <br><font color="#0000ff">get</font>; <br><font color="#0000ff">private</font> <br><font color="#0000ff">set</font>; }     <br><font color="#0000ff">public</font> Rebro(Point first, Point second, <br><font color="#0000ff">float</font> valueOfWeight)     {       FirstPoint = first;       SecondPoint = second;       Weight = valueOfWeight;     }   }</font> <br><font size="1" color="gray">* This source code was highlighted with <a href="http://virtser.net/blog/post/source-code-highlighter.aspx"><br><font size="1" color="gray">Source Code Highlighter</font></a>.</font>


<br><font size="2" face="Courier New" color="black"><br><font color="#008000">/// <summary></font>   <br><font color="#008000">/// Класс, реализующий вершину графа</font>   <br><font color="#008000">/// </summary></font>   <br><font color="#0000ff">class</font> <br><font color="#2B91AF">Point </font>  {     <br><font color="#0000ff">public</font> <br><font color="#0000ff">float</font> ValueMetka { <br><font color="#0000ff">get</font>; <br><font color="#0000ff">set</font>; }     <br><font color="#0000ff">public</font> <br><font color="#0000ff">string</font> Name { <br><font color="#0000ff">get</font>; <br><font color="#0000ff">private</font> <br><font color="#0000ff">set</font>; }     <br><font color="#0000ff">public</font> <br><font color="#0000ff">bool</font> IsChecked { <br><font color="#0000ff">get</font>; <br><font color="#0000ff">set</font>; }     <br><font color="#0000ff">public</font> Point predPoint { <br><font color="#0000ff">get</font>; <br><font color="#0000ff">set</font>; }     <br><font color="#0000ff">public</font> <br><font color="#0000ff">object</font> SomeObj { <br><font color="#0000ff">get</font>; <br><font color="#0000ff">set</font>; }     <br><font color="#0000ff">public</font> Point(<br><font color="#0000ff">int</font> <br><font color="#0000ff">value</font>,<br><font color="#0000ff">bool</font> ischecked)     {       ValueMetka = <br><font color="#0000ff">value</font>;       IsChecked = ischecked;       predPoint = <br><font color="#0000ff">new</font> Point();     }     <br><font color="#0000ff">public</font> Point(<br><font color="#0000ff">int</font> <br><font color="#0000ff">value</font>, <br><font color="#0000ff">bool</font> ischecked,<br><font color="#0000ff">string</font> name)     {       ValueMetka = <br><font color="#0000ff">value</font>;       IsChecked = ischecked;       Name = name;       predPoint = <br><font color="#0000ff">new</font> Point();     }     <br><font color="#0000ff">public</font> Point()     {     }       }</font> <br><font size="1" color="gray">* This source code was highlighted with <a href="http://virtser.net/blog/post/source-code-highlighter.aspx"><br><font size="1" color="gray">Source Code Highlighter</font></a>.</font>


<br><font size="2" face="Courier New" color="black"><br><font color="#008000">// <summary></font>   <br><font color="#008000">/// для печати графа</font>   <br><font color="#008000">/// </summary></font>   <br><font color="#0000ff">static</font> <br><font color="#0000ff">class</font> PrintGrath   {     <br><font color="#0000ff">public</font> <br><font color="#0000ff">static</font> <br><font color="#2B91AF">List</font><<br><font color="#0000ff">string</font>> PrintAllPoints(DekstraAlgorim da)     {       <br><font color="#2B91AF">List</font><<br><font color="#0000ff">string</font>> retListOfPoints = <br><font color="#0000ff">new</font> <br><font color="#2B91AF">List</font><<br><font color="#0000ff">string</font>>();       <br><font color="#0000ff">foreach</font> (Point p <br><font color="#0000ff">in</font> da.points)       {         retListOfPoints.Add(<br><font color="#0000ff">string</font>.Format(<br><font color="#A31515">"point name={0}, point value={1}, predok={2}"</font>, p.Name, p.ValueMetka, p.predPoint.Name ?? <br><font color="#A31515">"нет предка"</font>));       }       <br><font color="#0000ff">return</font> retListOfPoints;     }     <br><font color="#0000ff">public</font> <br><font color="#0000ff">static</font> <br><font color="#2B91AF">List</font><<br><font color="#0000ff">string</font>> PrintAllMinPaths(DekstraAlgorim da)     {       <br><font color="#2B91AF">List</font><<br><font color="#0000ff">string</font>> retListOfPointsAndPaths = <br><font color="#0000ff">new</font> <br><font color="#2B91AF">List</font><<br><font color="#0000ff">string</font>>();       <br><font color="#0000ff">foreach</font> (Point p <br><font color="#0000ff">in</font> da.points)       {                  <br><font color="#0000ff">if</font> (p != da.BeginPoint)         {           <br><font color="#0000ff">string</font> s = <br><font color="#0000ff">string</font>.Empty;           <br><font color="#0000ff">foreach</font> (Point p1 <br><font color="#0000ff">in</font> da.MinPath1(p))           {             s += <br><font color="#0000ff">string</font>.Format(<br><font color="#A31515">"{0} "</font>, p1.Name);           }           retListOfPointsAndPaths.Add(<br><font color="#0000ff">string</font>.Format(<br><font color="#A31515">"Point ={0},MinPath from {1} = {2}"</font>, p.Name, da.BeginPoint.Name, s));         }       }       <br><font color="#0000ff">return</font> retListOfPointsAndPaths;     }   }</font> <br><font size="1" color="gray">* This source code was highlighted with <a href="http://virtser.net/blog/post/source-code-highlighter.aspx"><br><font size="1" color="gray">Source Code Highlighter</font></a>.</font>


<br><font size="2" face="Courier New" color="black"> <br><font color="#0000ff">class</font> DekstraException:ApplicationException   {     <br><font color="#0000ff">public</font> DekstraException(<br><font color="#0000ff">string</font> message):<br><font color="#0000ff">base</font>(message)     {     }        }</font> <br><font size="1" color="gray">* This source code was highlighted with <a href="http://virtser.net/blog/post/source-code-highlighter.aspx"><br><font size="1" color="gray">Source Code Highlighter</font></a>.</font>